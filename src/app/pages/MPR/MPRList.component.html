<div class="row">
  <div class="col-md-4"><h4>{{mprTitle}}</h4></div>
  <div class="col-md-6"></div>
  <div class="col-md-2 text-right">
    <i class="fa fa-plus-square expand" aria-hidden="true" (click)="showHideFilterBlock()" pTooltip="Expand"></i>
  </div>
</div><br />
<form [formGroup]="MPRfilterForm">
  <div *ngIf="showFilterBlock" class="form-control" style="height:100%;border-radius:0px;">
    <div class="row">
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">From Date</label><br />
        <p-calendar class="mprldatepick" formControlName="FromDate" [(ngModel)]="fromDate" [monthNavigator]="true" [yearNavigator]="true" yearRange="1900:2050"></p-calendar>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">To Date</label>&nbsp;<br />
        <p-calendar class="mprldatepick" formControlName="ToDate" [(ngModel)]="toDate" [monthNavigator]="true" [yearNavigator]="true" yearRange="1900:2050"></p-calendar>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label for="docNo" class="form-label">Document Number</label>
        <input class="form-control border-secondary" type="text" formControlName="DocumentNo" [(ngModel)]="mprFilterParams.DocumentNo">
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label for="SaleOrderNo" class="form-label">Document Description</label>
        <input class="form-control border-secondary" formControlName="DocumentDescription" [(ngModel)]="mprFilterParams.DocumentDescription">
      </div>
    </div>

    <div *ngIf="typeOfList=='MPRCheckerList'" class="row">
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">Checked By</label>&nbsp;
        <div class="form-inline-list">
          <input type="text" disabled="true" class="form-control forms-input" formControlName="CheckedBy" [value]="MPRfilterForm.controls.CheckedBy.value">
          <!--<div class="input-group-append">
            <button type="button" class="btn btn-outline-secondary form-control" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','CheckedBy','',undefined)"></button>
          </div>-->
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group ">
        &nbsp;&nbsp;<label class="form-label">Checked Status</label>&nbsp;
        <select class="form-control dropdown" formControlName="CheckerStatus" [(ngModel)]="mprFilterParams.Status" ng-init="mprFilterParams.status='Pending'">
          <option *ngFor="let List of statusList" [ngValue]="List.StatusName">{{List.StatusName}}</option>
        </select>&nbsp;
      </div>
    </div>
    <div *ngIf="typeOfList=='MPRApproverList'" class="row form-group">
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">Approved By : </label>&nbsp;
        <div class="form-inline-list">
          <input type="text" disabled="true" class="form-control forms-input" formControlName="ApprovedBy" [value]="MPRfilterForm.controls.ApprovedBy.value">
          <!--<div class="input-group-append">
            <button type="button" class="btn btn-outline-secondary form-control" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','ApprovedBy','',undefined)"></button>
          </div>-->
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group ">
        &nbsp;&nbsp;<label class="form-label">Approved Status:</label>&nbsp;
        <select class="form-control dropdown" formControlName="ApprovalStatus" [(ngModel)]="mprFilterParams.Status" ng-init="mprFilterParams.status='Pending'">
          <option *ngFor="let List of statusList" [ngValue]="List.StatusName">{{List.StatusName}}</option>
        </select>&nbsp;
      </div>
    </div>
    <div *ngIf="showCMMFilter" class="row">
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">Department</label>&nbsp;
        <div class="form-inline-list">
          <input type="text" class="form-control forms-input" [attr.disabled]="depDisable == true ? true : null" formControlName="DepartmentId" [value]="MPRfilterForm.controls.DepartmentId.value">
          <span class="input-group-append">
            <button type="button" [disabled]="depDisable" class="btn btn-outline-secondary form-control btn-border" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','DepartmentId',MPRfilterForm.controls.DepartmentId.value,undefined)"></button>
          </span>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">Job Code</label>&nbsp;
        <div class="form-inline-list">
          <input type="text" class="form-control forms-input" formControlName="JobCode" [value]="MPRfilterForm.controls.JobCode.value">
          <span class="input-group-append">
            <button type="button" class="btn btn-outline-secondary form-control btn-border" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','JobCode',MPRfilterForm.controls.JobCode.value,undefined)"></button>
          </span>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label for="purposeIssuingMpr" class="form-label">Purpose Issuing MPR</label>
        <div class="form-control" style="height:70%">
          <p-radioButton class="form-inline" name="group1" value="1" label="For Enquiry" [(ngModel)]="mprFilterParams.IssuePurposeId" formControlName="IssuePurposeId" inputId="opt1"></p-radioButton>
          <p-radioButton class="form-inline" name="group1" value="2" label="For Issuing PO" [(ngModel)]="mprFilterParams.IssuePurposeId" formControlName="IssuePurposeId" inputId="opt2"></p-radioButton>
        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label for="BuyerGroupId" class="form-label">Item Description</label>
        <div class="form-inline-list  ml-2 ">
          <input type="text" class="form-control forms-input" formControlName="ItemDescription" [value]="MPRfilterForm.controls.ItemDescription.value">
          <div class="input-group-append">
            <button type="button" class="btn btn-outline-secondary form-control btn-border" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','ItemDescription',MPRfilterForm.controls.ItemDescription.value,undefined)"></button>
          </div>

        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label class="form-label">Ge Ps Approval Id</label>
        <input class="form-control" type="text" formControlName="GEPSApprovalId" [(ngModel)]="mprFilterParams.GEPSApprovalId">
      </div>

      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label for="BuyerGroupId" class="form-label">Buyer of Group</label>
        <div class="form-inline-list  ml-2 ">
          <input type="text" class="form-control forms-input" formControlName="BuyerGroupId" [value]="MPRfilterForm.controls.BuyerGroupId.value">
          <div class="input-group-append">
            <button type="button" class="btn btn-outline-secondary form-control btn-border" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','BuyerGroupId',MPRfilterForm.controls.BuyerGroupId.value,undefined)"></button>
          </div>

        </div>
      </div>
      <div class="col-lg-3 col-md-3 col-sm-3 form-group">
        <label for="BuyerGroupId" class="form-label">Assigned To</label>
        <div class="form-inline-list  ml-2 ">
          <input type="text" class="form-control forms-input" formControlName="AssignEmployee" [value]="MPRfilterForm.controls.AssignEmployee.value">
          <div class="input-group-append">
            <button type="button" class="btn btn-outline-secondary form-control btn-border" style="cursor:pointer" pButton icon="fa fa-list" aria-hidden="true" (click)="bindSearchListData($event,'MPRfilterForm','AssignEmployee',MPRfilterForm.controls.AssignEmployee.value,undefined)"></button>
          </div>

        </div>
      </div>
    </div>
    <div class="row">
      <div class="ui-g-4 ui-md-4">
      </div>
      <div class="ui-g-4 ui-md-4 text-center pr-3">
        <button type="button" class="btn btn-success" (click)="bindList()" label="Save">Submit</button>
      </div>
    </div>
  </div>
</form>
<div class="form-control h-100 p-0" style="border-radius:0px;">
  <p-table #dt [value]="mprList" [paginator]="true" [rows]="10" [resizableColumns]="true" [scrollable]="true" [lazy]="true" [loading]="loading">
    <ng-template pTemplate="caption p-0">
      <!--<div style="text-align: right">
        <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
        <input type="text" pInputText size="50" placeholder="Global Filter" (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto">
      </div>-->
    </ng-template>
    <ng-template pTemplate="header">
      <tr class="mprltbldata">
        <th style="width:50px">S.No</th>
        <th>MPR Document Number</th>
        <th>Description</th>
        <th *ngIf="showCMMFilter">Job Code</th>
        <th *ngIf="showCMMFilter">Job Name</th>
        <th *ngIf="showCMMFilter">Purpose of issuing MPR</th>
        <th *ngIf="showCMMFilter && MPRfilterForm.controls.ItemDescription.value">Item Description</th>
        <th *ngIf="showCMMFilter">Ge Ps Approval Id</th>
        <th *ngIf="showCMMFilter">Buyer Group Name</th>
        <th>Preapared By</th>
        <th>Preapared On</th>
        <th>Check By</th>
        <th>Check Status</th>
        <th>Approved By</th>
        <th>Approval Status</th>
        <th>AssignTo</th>
        <th>Edit</th>
        <th>Copy</th>
        <th>Revise</th>
      </tr>
      <!--<tr>
        <th></th>
        <th><input pInputText type="text" (input)="dt.filter($event.target.value, 'DocumentNo', 'contains')"></th>
        <th></th>
        <th></th>
        <th></th>
        <th><input pInputText type="text" (input)="dt.filter($event.target.value, 'CheckedName', 'contains')"></th>
        <th></th>
        <th></th>
        <th></th>
      </tr>-->
    </ng-template>
    <ng-template pTemplate="body" let-rowData let-editing="editing" let-ri="rowIndex" let-rindex=0>
      <tr class="mprltbldata">
        <td style="width:50px">
          {{ri+1}}
        </td>
        <td class="ptable-cell"><a [routerLink]="['/SCM/MPRForm',rowData.RevisionId]" routerLinkActive="active">{{rowData.DocumentNo}}</a></td>
        <td class="ptable-cell">{{rowData.DocumentDescription}}</td>
        <td *ngIf="showCMMFilter" class="ptable-cell">{{rowData.JobCode}}</td>
        <td *ngIf="showCMMFilter" class="ptable-cell">{{rowData.JobName}}</td>
        <td *ngIf="showCMMFilter" class="ptable-cell">{{rowData.IssuePurposeId==1?'For Enquiry':'For Issuing PO'}}</td>
        <td *ngIf="showCMMFilter && MPRfilterForm.controls.ItemDescription.value" class="ptable-cell">{{rowData.ItemDescription}}</td>
        <td *ngIf="showCMMFilter" class="ptable-cell">{{rowData.GEPSApprovalId}}</td>
        <td *ngIf="showCMMFilter" class="ptable-cell">{{rowData.BuyerGroupName}}</td>
        <td class="ptable-cell">{{rowData.PreparedName}}</td>
        <td class="ptable-cell">{{rowData.PreparedOn | date :  constants.dateFormat}}</td>
        <td class="ptable-cell">{{rowData.CheckedName}}</td>
        <td class="ptable-cell">{{rowData.CheckStatus }}</td>
        <td class="ptable-cell">{{rowData.ApproverName}}</td>
        <td class="ptable-cell">{{rowData.ApprovalStatus}}</td>
        <td class="ptable-cell">{{rowData.AssignEmployeeName}}</td>
        <td><button *ngIf="(typeOfList=='MPRList' || typeOfList=='MPRPendingList') && rowData.CheckStatus=='Pending' && rowData.ApprovalStatus=='Pending'" pButton type="button" icon="fa fa-pencil" class="ui-button-info p-1" (click)="onRowEditInit(rowData)"></button></td>
        <td><button pButton type="button" icon="fa fa-copy" class="ui-button-info p-1" (click)="onRevisionCopy(rowData)"></button></td>
        <td><button *ngIf="typeOfList=='MPRList' && rowData.ApprovalStatus=='Approved'" pButton type="button" icon="fa fa-plus" class="ui-button-info p-1" (click)="onRevise(rowData)"></button></td>
      </tr>
    </ng-template>
  </p-table>
</div>
<p-dialog #dialog header="List View :" [(visible)]="showList" [contentStyle]="{'overflow':'visible'}">
  <div class="ui-g ui-fluid">
    <p-listbox [options]="searchItems" [(ngModel)]="selectedItem" optionLabel="name" (onChange)="onSelectedOptionsChange(selectedItem,null)"></p-listbox>
  </div>
  <p-footer>
    <div class="ui-dialog-buttonpane ui-helper-clearfix">
      <button type="button" pButton icon="fa fa-close" (click)="dialogCancel('showList')" label="Cancel"></button>
    </div>
  </p-footer>
</p-dialog>
